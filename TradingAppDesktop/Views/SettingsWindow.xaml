<Window x:Class="TradingAppDesktop.Views.SettingsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Settings" Height="480" Width="680" WindowStartupLocation="CenterOwner" ResizeMode="CanResize" MinWidth="520" MinHeight="360">
    <Border Background="{DynamicResource DarkBackground}" Padding="12">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TextBlock Text="Settings" Foreground="{DynamicResource AccentColor}" FontSize="16" FontWeight="Bold"/>

            <Grid Grid.Row="1" Margin="0,12,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="180" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Left nav -->
                <StackPanel Grid.Column="0" Margin="0,0,12,0">
                    <TextBlock Text="Sections" Foreground="{DynamicResource PrimaryForeground}" FontWeight="SemiBold"/>
                    <ListBox x:Name="NavList" Margin="0,6,0,0" Height="280"/>
                </StackPanel>

                <!-- Right content area (scrollable) -->
                <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2*" />
                            <ColumnDefinition Width="3*" />
                        </Grid.ColumnDefinitions>

                        <!-- Left column: Theme -->
                        <StackPanel x:Name="ThemePanel" Grid.Column="0" Margin="0,0,12,0">
                            <TextBlock Text="Theme" Foreground="{DynamicResource PrimaryForeground}" FontWeight="SemiBold"/>
                            <ListBox x:Name="ThemeList" Margin="0,6,0,0" Height="220" VerticalContentAlignment="Center"/>
                        </StackPanel>

                        <!-- Right column: Strategies / Harmonic -->
                        <StackPanel x:Name="StrategiesContent" Grid.Column="1">
                            <TextBlock Text="Strategies" Foreground="{DynamicResource PrimaryForeground}" FontWeight="SemiBold"/>
                            <ComboBox x:Name="StrategySelector" Margin="0,6,0,0" Width="320" HorizontalAlignment="Left" SelectionChanged="StrategySelector_SelectionChanged">
                                <ComboBoxItem Content="HarmonicPattern" />
                                <ComboBoxItem Content="BollingerNoSqueeze" />
                                <ComboBoxItem Content="EmaCrossoverVolume" />
                                <ComboBoxItem Content="OtherStrategy (disabled)" IsEnabled="False"/>
                                <ComboBoxItem Content="OtherStrategy2 (disabled)" IsEnabled="False"/>
                            </ComboBox>

                            <Border Margin="0,10,0,0" Padding="8" Background="{DynamicResource DarkPanelBackground}" CornerRadius="4">
                                <StackPanel>
                                    <StackPanel x:Name="HarmonicPanel" Visibility="Collapsed">
                                    <TextBlock Text="Harmonic Patterns" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryForeground}"/>
                                    <UniformGrid Columns="2" Margin="0,8,0,0">
                                        <CheckBox x:Name="ChkGartley" Content="Gartley" IsChecked="True" Foreground="{DynamicResource PrimaryForeground}"/>
                                        <CheckBox x:Name="ChkButterfly" Content="Butterfly" IsChecked="True" Foreground="{DynamicResource PrimaryForeground}"/>
                                        <CheckBox x:Name="ChkBat" Content="Bat" IsChecked="True" Foreground="{DynamicResource PrimaryForeground}"/>
                                        <CheckBox x:Name="ChkCrab" Content="Crab" IsChecked="True" Foreground="{DynamicResource PrimaryForeground}"/>
                                        <CheckBox x:Name="ChkCypher" Content="Cypher" IsChecked="True" Foreground="{DynamicResource PrimaryForeground}"/>
                                        <CheckBox x:Name="ChkShark" Content="Shark" IsChecked="True" Foreground="{DynamicResource PrimaryForeground}"/>
                                    </UniformGrid>

                                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0" VerticalAlignment="Center">
                                        <CheckBox x:Name="ChkUseTrendFilter" Content="Use Trend Filter (SMA)" IsChecked="False" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryForeground}"/>
                                    </StackPanel>

                                    

                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0" VerticalAlignment="Center">
                                        <TextBlock Text="Validation bars:" VerticalAlignment="Center" Margin="0,0,8,0" Foreground="{DynamicResource PrimaryForeground}"/>
                                        <TextBox x:Name="TxtValidationBars" Width="64" Text="3"/>
                                    </StackPanel>
                                </StackPanel>
                                
                                <!-- Bollinger settings panel (sibling to HarmonicPanel) -->
                                <StackPanel x:Name="BollingerPanel" Visibility="Collapsed" Margin="0,8,0,0">
                                    <TextBlock Text="Bollinger No-Squeeze Settings" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryForeground}"/>
                                    <UniformGrid Columns="2" Margin="0,8,0,0">
                                        <TextBlock Text="BB Period:" Foreground="{DynamicResource PrimaryForeground}" VerticalAlignment="Center" ToolTip="Bollinger Bands period. Lower = faster response and more entries."/>
                                        <TextBox x:Name="TxtBBPeriod" Width="120" Text="200" ToolTip="Bollinger Bands period. Lower = faster response and more entries."/>

                                        <TextBlock Text="BB StdDev:" Foreground="{DynamicResource PrimaryForeground}" VerticalAlignment="Center" ToolTip="StdDev multiplier for bands. Lower = narrower bands → more cross events."/>
                                        <TextBox x:Name="TxtBBStdDev" Width="120" Text="2.0" ToolTip="StdDev multiplier for bands. Lower = narrower bands → more cross events."/>

                                        <TextBlock Text="Squeeze Min (norm):" Foreground="{DynamicResource PrimaryForeground}" VerticalAlignment="Center" ToolTip="Minimum normalized BB width (bbWidth/ATR) to be considered NOT squeezed. Lower → more entries."/>
                                        <TextBox x:Name="TxtSqueezeMin" Width="120" Text="1.2" ToolTip="Minimum normalized BB width (bbWidth/ATR) to be considered NOT squeezed. Lower → more entries."/>

                                        <TextBlock Text="Volume Mult:" Foreground="{DynamicResource PrimaryForeground}" VerticalAlignment="Center" ToolTip="Volume multiplier vs average. Higher = requires a larger volume candle for entry; lower → more entries."/>
                                        <TextBox x:Name="TxtVolumeMultiplier" Width="120" Text="1.2" ToolTip="Volume multiplier vs average. Higher = requires a larger volume candle for entry; lower → more entries."/>

                                        <TextBlock Text="Avg Vol Period:" Foreground="{DynamicResource PrimaryForeground}" VerticalAlignment="Center" ToolTip="Window (candles) used to compute average volume. Shorter = more sensitive to recent spikes."/>
                                        <TextBox x:Name="TxtAvgVolumePeriod" Width="120" Text="20" ToolTip="Window (candles) used to compute average volume. Shorter = more sensitive to recent spikes."/>

                                        <TextBlock Text="Delayed Re-entry Bars:" Foreground="{DynamicResource PrimaryForeground}" VerticalAlignment="Center" ToolTip="Number of previous candles that must be outside the band before current-candle re-entry. Lower → more entries."/>
                                        <TextBox x:Name="TxtDelayedReentryPrevBars" Width="120" Text="3" ToolTip="Number of previous candles that must be outside the band before current-candle re-entry. Lower → more entries."/>

                                        <TextBlock Text="Trend Gate:" Foreground="{DynamicResource PrimaryForeground}" VerticalAlignment="Center" ToolTip="Trend filter: EMA requires price above EMA; ADX requires ADX≥threshold; RSI requires RSI>50; None disables trend gate."/>
                                        <ComboBox x:Name="CboTrendGate" Width="160" ToolTip="Trend filter: EMA requires price above EMA; ADX requires ADX≥threshold; RSI requires RSI>50; None disables trend gate.">
                                            <ComboBoxItem Content="None" />
                                            <ComboBoxItem Content="EMA" />
                                            <ComboBoxItem Content="ADX" />
                                            <ComboBoxItem Content="RSI" />
                                        </ComboBox>

                                        <TextBlock Text="Trend Period:" Foreground="{DynamicResource PrimaryForeground}" VerticalAlignment="Center" ToolTip="Period used for EMA/ADX/RSI trend calculations. Lower = more responsive."/>
                                        <TextBox x:Name="TxtTrendPeriod" Width="120" Text="50" ToolTip="Period used for EMA/ADX/RSI trend calculations. Lower = more responsive."/>

                                        <TextBlock Text="ADX Threshold:" Foreground="{DynamicResource PrimaryForeground}" VerticalAlignment="Center" ToolTip="Minimum ADX value to consider trend strong when ADX trend gate is selected. Lower → more entries."/>
                                        <TextBox x:Name="TxtAdxThreshold" Width="120" Text="20" ToolTip="Minimum ADX value to consider trend strong when ADX trend gate is selected. Lower → more entries."/>

                                        <TextBlock Text="Debug Mode:" Foreground="{DynamicResource PrimaryForeground}" VerticalAlignment="Center" ToolTip="Enable verbose debug logging showing gate checks and reasons signals were allowed or blocked."/>
                                        <CheckBox x:Name="ChkDebugMode" IsChecked="True" VerticalAlignment="Center" ToolTip="Enable verbose debug logging showing gate checks and reasons signals were allowed or blocked."/>
                                    </UniformGrid>
                                </StackPanel>
                                
                                <!-- EMA Crossover + Volume settings panel -->
                                <StackPanel x:Name="EmaCrossoverPanel" Visibility="Collapsed" Margin="0,8,0,0">
                                    <TextBlock Text="EMA Crossover + Volume Settings" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryForeground}"/>
                                    <UniformGrid Columns="2" Margin="0,8,0,0">
                                        <TextBlock Text="Fast EMA Length:" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryForeground}" ToolTip="Shorter fast EMA reacts faster to price changes and will produce earlier cross signals (may increase false signals)." />
                                        <TextBox x:Name="TxtEmaFastLen" Width="120" Text="25" ToolTip="Shorter fast EMA reacts faster to price changes and will produce earlier cross signals (may increase false signals)." />

                                        <TextBlock Text="Slow EMA Length:" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryForeground}" ToolTip="Longer slow EMA smooths trend detection; increasing it reduces signal frequency and helps avoid noise." />
                                        <TextBox x:Name="TxtEmaSlowLen" Width="120" Text="50" ToolTip="Longer slow EMA smooths trend detection; increasing it reduces signal frequency and helps avoid noise." />

                                        <TextBlock Text="Volume MA Length:" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryForeground}" ToolTip="Number of candles used to compute the average volume baseline. Shorter windows react to recent spikes; longer windows provide a smoother baseline." />
                                        <TextBox x:Name="TxtEmaVolMaLen" Width="120" Text="20" ToolTip="Number of candles used to compute the average volume baseline. Shorter windows react to recent spikes; longer windows provide a smoother baseline." />

                                        <TextBlock Text="Volume Multiplier:" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryForeground}" ToolTip="Entry requires current volume > (volume MA × multiplier). Increasing multiplier requires larger volume spikes for entries, reducing false signals during low activity." />
                                        <TextBox x:Name="TxtEmaVolMultiplier" Width="120" Text="1.0" ToolTip="Entry requires current volume > (volume MA × multiplier). Increasing multiplier requires larger volume spikes for entries, reducing false signals during low activity." />
                                    </UniformGrid>
                                </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Placeholder area for other sections -->
                        <TextBlock x:Name="PlaceholderText" Grid.ColumnSpan="2" Visibility="Collapsed" Foreground="{DynamicResource PrimaryForeground}" TextWrapping="Wrap" Margin="0,12,0,0"/>
                    </Grid>
                </ScrollViewer>
            </Grid>

            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button x:Name="CloseButton" Content="Close" Width="80" Margin="8" Click="CloseButton_Click"/>
            </StackPanel>
        </Grid>
    </Border>
</Window>
