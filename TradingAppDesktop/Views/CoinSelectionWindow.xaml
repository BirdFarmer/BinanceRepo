<Window x:Class="TradingAppDesktop.Views.CoinSelectionWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Coin Selection Management" Height="800" Width="1000" Background="{DynamicResource DarkBackground}"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip">
    
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
            <TextBlock Text="Coin Selection Management" 
                   FontSize="18" FontWeight="Bold" VerticalAlignment="Center" Style="{StaticResource CardHeader}"/>
                <Button x:Name="RefreshButton" Content="ðŸ”„ Refresh" Click="RefreshButton_Click"
                    Margin="15,0,0,0" Padding="10,5" Background="{DynamicResource AccentColor}" Foreground="White"/>
        </StackPanel>

        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- Left: Coin Selection Interface -->
            <Border Grid.Column="0" Style="{StaticResource CardPanel}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Selection Mode Tabs -->
                    <TabControl Grid.Row="0">
                        <TabItem Header="ðŸš€ Auto-Select">
                            <StackPanel Margin="10">
                                <GroupBox Header="Auto-Selection Methods">
                                    <StackPanel Margin="5">
                                        <ComboBox x:Name="AutoSelectionMethod" Height="30" Margin="0,0,0,10">
                                            <ComboBoxItem Content="Top by Volume (High Liquidity)"/>
                                            <ComboBoxItem Content="Top by Price Change (Volatility)"/>
                                            <ComboBoxItem Content="Top by Volume Change (Momentum)"/>
                                            <ComboBoxItem Content="Composite Score (Volume + Price Change)"/>
                                            <ComboBoxItem Content="Biggest Coins (High Market Cap)"/>
                                        </ComboBox>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                            <TextBlock Text="Limit:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                            <TextBox x:Name="LimitTextBox" Text="80" Width="60" 
                                                     VerticalAlignment="Center" Margin="0,0,10,0"/>
                                                <Button x:Name="GenerateAutoButton" Content="Generate Selection" 
                                                    Click="GenerateAutoButton_Click" 
                                                    Background="{DynamicResource SuccessColor}" Foreground="White" 
                                                    Padding="10,5"/>
                                        </StackPanel>
                                        
                                        <TextBlock x:Name="AutoSelectionInfo" TextWrapping="Wrap" 
                                                   Foreground="{DynamicResource SecondaryForeground}" FontSize="11"/>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </TabItem>
                        
                        <TabItem Header="âœ‹ Manual Select">
                            <StackPanel Margin="10">
                                <GroupBox Header="Manual Coin Selection">
                                    <StackPanel Margin="5">
                                        <TextBox x:Name="ManualCoinsTextBox" Height="80" 
                                                 TextWrapping="Wrap" AcceptsReturn="True"
                                                 ToolTip="Enter coin pairs separated by commas or new lines&#x0a;Example: BTCUSDT, ETHUSDT, ADAUSDT"/>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,6,0,6">
                                            <Button x:Name="NormalizeButton" Content="Trim/Normalize â–¾" Height="26" Click="NormalizeButton_Click">
                                                <Button.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem Header="One per line" Click="Normalize_OnePerLine_Click"/>
                                                        <MenuItem Header="Comma separated" Click="Normalize_CommaSeparated_Click"/>
                                                    </ContextMenu>
                                                </Button.ContextMenu>
                                            </Button>
                                            <TextBlock Text="" Width="8"/>
                                            <TextBlock VerticalAlignment="Center" Foreground="{DynamicResource SecondaryForeground}" FontSize="11">Normalize pasted text into one-per-line or comma-separated formats</TextBlock>
                                        </StackPanel>

                                        <Button x:Name="ApplyManualButton" Content="Apply Manual Selection" 
                                            Click="ApplyManualButton_Click" Margin="0,10,0,0"
                                            Background="{DynamicResource WarningColor}" Foreground="White" 
                                            Padding="10,5"/>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </TabItem>
                        
                        <TabItem Header="ðŸ’¾ Saved Lists">
                            <StackPanel Margin="10">
                                <GroupBox Header="Saved Coin Pair Lists">
                                    <StackPanel Margin="5">
                                        <ListBox x:Name="SavedListsListBox" Height="120" 
                                                 SelectionChanged="SavedListsListBox_SelectionChanged"
                                                 PreviewKeyDown="SavedListsListBox_PreviewKeyDown">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBox Text="{Binding ., Mode=OneWay}" IsReadOnly="True" BorderThickness="0" Background="Transparent" Padding="0"/>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                            <ListBox.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Header="Copy Selected" Click="CopySelectedSavedList_Click"/>
                                                    <MenuItem Header="Delete Selected" Click="DeleteSavedListButton_Click"/>
                                                </ContextMenu>
                                            </ListBox.ContextMenu>
                                        </ListBox>
                                        
                                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                <Button x:Name="LoadSavedListButton" Content="Load Selected" 
                                                    Click="LoadSavedListButton_Click" Margin="0,0,5,0"
                                                    Padding="10,5" Background="{DynamicResource AccentColor}" Foreground="White"/>
                                                <Button x:Name="DeleteSavedListButton" Content="Delete" 
                                                    Click="DeleteSavedListButton_Click"
                                                    Background="{DynamicResource DangerColor}" Foreground="White" 
                                                    Padding="10,5"/>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </TabItem>
                    </TabControl>

                    <!-- Selected Coins Display -->
                    <Border Grid.Row="1" BorderBrush="{DynamicResource LightBorderBrush}" BorderThickness="0,1,0,0" Margin="0,10,0,0" Padding="10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Text="Selected Coin Pairs:" Style="{StaticResource CardHeader}" Margin="0,0,0,5"/>
                            <ListBox Grid.Row="1" x:Name="SelectedCoinsListBox" 
                                     SelectionMode="Extended" Height="400"
                                     PreviewKeyDown="SelectedCoinsListBox_PreviewKeyDown">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBox Text="{Binding ., Mode=OneWay}" IsReadOnly="True" BorderThickness="0" Background="Transparent" Padding="0"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                                <ListBox.ContextMenu>
                                    <ContextMenu>
                                        <MenuItem Header="Copy Selected" Click="CopySelectedCoins_Click"/>
                                        <MenuItem Header="Copy Selected To Manual" Click="CopySelectedToManual_Click"/>
                                        <Separator />
                                        <MenuItem Header="Remove Selected" Click="RemoveSelectedCoins_Click"/>
                                    </ContextMenu>
                                </ListBox.ContextMenu>
                            </ListBox>
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- Right: Preview & Actions Panel -->
            <Border Grid.Column="2" Style="{StaticResource CardPanel}" Padding="15">
                <StackPanel>
                    <TextBlock Text="Selection Summary" Style="{StaticResource CardHeader}" Margin="0,0,0,15"/>
                    
                    <StackPanel Margin="0,0,0,15">
                        <TextBlock x:Name="SelectedCountText" Text="Selected Coins: 0" Margin="0,0,0,3" Foreground="{DynamicResource PrimaryForeground}"/>
                        <TextBlock x:Name="SelectionMethodText" Text="Method: None" Margin="0,0,0,3" Foreground="{DynamicResource PrimaryForeground}"/>
                        <TextBlock x:Name="TimestampText" Text="Last Updated: Never" Margin="0,0,0,10" Foreground="{DynamicResource PrimaryForeground}"/>
                    </StackPanel>
                    
                    <Separator Margin="0,0,0,15"/>
                    
                    <GroupBox Margin="0,0,0,15">
                        <GroupBox.Header>
                            <TextBlock Text="Quick Actions" Style="{StaticResource CardHeader}"/>
                        </GroupBox.Header>
                        <StackPanel>
                            <Button Content="Apply to Trading" x:Name="ApplyButton" 
                                Click="ApplyButton_Click"
                                Background="{DynamicResource SuccessColor}" Foreground="White" 
                                Height="35" FontWeight="Bold" Margin="0,0,0,5"/>
                            
                            <TextBlock Text="List name (optional)" Style="{StaticResource CardHeader}" Margin="0,4,0,2"/>
                            <TextBox x:Name="ListNameTextBox" Height="26" Margin="0,0,0,6"/>

                            <Button Content="Save Current List" x:Name="SaveListButton"
                                Click="SaveListButton_Click"
                                Background="{DynamicResource AccentColor}" Foreground="White" 
                                Height="30" Margin="0,0,0,5"/>
                        
                            <Button Content="Clear Selection" x:Name="ResetButton"
                                Click="ResetButton_Click"
                                Background="{DynamicResource DangerColor}" Foreground="White" 
                                Height="30" Margin="0,0,0,5"/>
                        </StackPanel>
                    </GroupBox>

                    <GroupBox>
                        <GroupBox.Header>
                            <TextBlock Text="Database Info" Style="{StaticResource CardHeader}"/>
                        </GroupBox.Header>
                        <StackPanel Margin="5">
                            <Button x:Name="ViewDatabaseStatsButton" Content="View Database Statistics" 
                                    Click="ViewDatabaseStatsButton_Click" Margin="0,0,0,5"/>
                            <TextBlock x:Name="DatabaseInfoText" TextWrapping="Wrap" FontSize="10" Foreground="{DynamicResource PrimaryForeground}"/>
                        </StackPanel>
                    </GroupBox>
                    
                        <Button Content="Close" x:Name="CloseButton"
                            Click="CloseButton_Click"
                            Height="30" Margin="0,15,0,0" Background="{DynamicResource CardBackground}" Foreground="{DynamicResource PrimaryForeground}"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="2" Margin="0,10,0,0">
            <StatusBarItem>
                <TextBlock x:Name="StatusText" Text="Ready - Connected to database"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>